<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>SOUMNT! - Seus v√≠deos em um minuto</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="header">
    <img src="assets/logo-soumnt.png" alt="SOUMNT Logo" class="logo" />
    <h1>SOUMNT! - Baixador de v√≠deos</h1>
    <button id="settings" class="settings-btn">
      <span class="icon">‚öôÔ∏è</span>
    </button>
  </div>

  <div id="settingsModal" class="settings-modal hidden">
    <div class="settings-content">
      <h3>Configura√ß√µes</h3>
      
      <div class="setting-row">
        <label for="language">Idioma:</label>
        <select id="language">
          <option value="pt">Portugu√™s</option>
          <option value="en">English</option>
        </select>
      </div>

      <div class="setting-row">
        <label for="theme">Tema:</label>
        <select id="theme">
          <option value="catppuccin">Default</option>
          <option value="matrix">Matrix</option>
          <option value="light">Light</option>
          <option value="guic">Guic</option>
          <option value="golios">Golios</option>
          <option value="manni">Manni</option>
          <option value="beg">Beg</option>
          <option value="toba">Toba</option>
          <option value="luao">Luao</option>
        </select>
      </div>

      <div class="settings-buttons">
        <button id="closeSettings">Fechar</button>
      </div>
    </div>
  </div>

  <div class="row">
    <label for="url">URL:</label>
    <input id="url" type="text" placeholder="https://www.youtube.com/watch?v=..." />
    <button id="paste">
      <span class="icon">üìã</span>
      Colar
    </button>
  </div>

  <div class="row">
    <label for="outDir">Pasta:</label>
    <input id="outDir" type="text" placeholder="Escolha uma pasta de destino" readonly />
    <button id="choose">
      <span class="icon">üìÅ</span>
      Escolher‚Ä¶
    </button>
  </div>

  <div class="row">
    <label for="format">Formato:</label>
    <select id="format">
      <option value="">Melhor qualidade dispon√≠vel</option>
      <option value="best[height<=720]">720p ou menor</option>
      <option value="best[height<=480]">480p ou menor</option>
      <option value="best[height<=360]">360p ou menor</option>
      <option value="bestaudio">Apenas √°udio (melhor qualidade)</option>
      <option value="worst">Menor tamanho de arquivo</option>
      <option value="bestvideo+bestaudio/best">Melhor v√≠deo + √°udio</option>
    </select>
  </div>

  <div class="row download-row">
    <button id="download">
      <span class="icon">‚¨áÔ∏è</span>
      Baixar V√≠deo
    </button>
  </div>

  <div class="status" id="status"></div>

  <progress id="progress" value="0" max="100"></progress>
  <p><small>Obs: apenas baixamos v√≠deos do <code>YouTube</code>, nada de <code>X</code> ou <code>Instagram</code> por enquanto... Quando que ser√° lan√ßada a atualiza√ß√£o? Hahahaha SOUMNT!</small></p>

  <div class="row logs-row">
    <button id="toggleLogs">
      <span class="icon">ü§ì</span>
      Mostrar Logs
    </button>
  </div>

  <div class="logs-section hidden">
    <h3>Log</h3>
    <div id="log"></div>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);
    const statusEl = $("status");
    const logEl = $("log");
    const progress = $("progress");
    const logsSection = document.querySelector('.logs-section');
    const toggleLogsBtn = $("toggleLogs");
    const settingsModal = $("settingsModal");
    const settingsBtn = $("settings");
    const closeSettingsBtn = $("closeSettings");
    const themeSelect = $("theme");
    const languageSelect = $("language");
    let logsVisible = false;

    const translations = {
      pt: {
        title: "SOUMNT! - Baixador de v√≠deos",
        url: "URL:",
        folder: "Pasta:",
        format: "Formato:",
        download: "Baixar V√≠deo",
        showLogs: "Mostrar Logs",
        hideLogs: "Ocultar Logs",
        settings: "Configura√ß√µes",
        language: "Idioma:",
        theme: "Tema:",
        close: "Fechar",
        urlPlaceholder: "https://www.youtube.com/watch?v=...",
        folderPlaceholder: "Escolha uma pasta de destino",
        choose: "Escolher‚Ä¶",
        paste: "Colar",
        bestQuality: "Melhor qualidade dispon√≠vel",
        q720: "720p ou menor",
        q480: "480p ou menor", 
        q360: "360p ou menor",
        audioOnly: "Apenas √°udio (melhor qualidade)",
        smallest: "Menor tamanho de arquivo",
        bestVideo: "Melhor v√≠deo + √°udio",
        downloading: "Baixando‚Ä¶",
        completed: "Conclu√≠do ‚úÖ",
        failed: "Falhou ‚ùå",
        urlError: "Informe a URL do v√≠deo.",
        folderError: "Escolha a pasta de destino.",
        note: "Obs: apenas baixamos v√≠deos do YouTube, nada de X ou Instagram por enquanto... Quando que ser√° lan√ßada a atualiza√ß√£o? Hahahaha SOUMNT!"
      },
      en: {
        title: "SOUMNT!(Just a Minute!) - Video Downloader",
        url: "URL:",
        folder: "Folder:",
        format: "Format:",
        download: "Download Video",
        showLogs: "Show Logs",
        hideLogs: "Hide Logs", 
        settings: "Settings",
        language: "Language:",
        theme: "Theme:",
        close: "Close",
        urlPlaceholder: "https://www.youtube.com/watch?v=...",
        folderPlaceholder: "Choose a destination folder",
        choose: "Choose‚Ä¶",
        paste: "Paste",
        bestQuality: "Best quality available",
        q720: "720p or lower",
        q480: "480p or lower",
        q360: "360p or lower", 
        audioOnly: "Audio only (best quality)",
        smallest: "Smallest file size",
        bestVideo: "Best video + audio",
        downloading: "Downloading‚Ä¶",
        completed: "Completed ‚úÖ",
        failed: "Failed ‚ùå",
        urlError: "Please enter the video URL.",
        folderError: "Please choose a destination folder.",
        note: "Note: we only download YouTube videos, no X or Instagram for now... When will the update be released? Hahahaha JUSTAMINUTE!"
      }
    };

    let currentLang = 'pt';

    function updateTexts() {
      const t = translations[currentLang];
      document.title = t.title;
      document.querySelector('h1').textContent = t.title;
      document.querySelector('label[for="url"]').textContent = t.url;
      document.querySelector('label[for="outDir"]').textContent = t.folder;
      document.querySelector('label[for="format"]').textContent = t.format;
      $("url").placeholder = t.urlPlaceholder;
      $("outDir").placeholder = t.folderPlaceholder;
      $("choose").innerHTML = `<span class="icon">üìÅ</span> ${t.choose}`;
      $("paste").innerHTML = `<span class="icon">üìã</span> ${t.paste}`;
      $("download").innerHTML = `<span class="icon">‚¨áÔ∏è</span> ${t.download}`;
      
      const formatOptions = $("format").options;
      formatOptions[0].textContent = t.bestQuality;
      formatOptions[1].textContent = t.q720;
      formatOptions[2].textContent = t.q480;
      formatOptions[3].textContent = t.q360;
      formatOptions[4].textContent = t.audioOnly;
      formatOptions[5].textContent = t.smallest;
      formatOptions[6].textContent = t.bestVideo;

      if (!logsVisible) {
        toggleLogsBtn.innerHTML = `<span class="icon">ü§ì</span> ${t.showLogs}`;
      } else {
        toggleLogsBtn.innerHTML = `<span class="icon">ü§ì</span> ${t.hideLogs}`;
      }

      document.querySelector('.settings-content h3').textContent = t.settings;
      document.querySelector('.setting-row label[for="language"]').textContent = t.language;
      document.querySelector('.setting-row label[for="theme"]').textContent = t.theme;
      closeSettingsBtn.textContent = t.close;
      document.querySelector('small').innerHTML = t.note.replace(/`([^`]+)`/g, '<code>$1</code>');
    }

    settingsBtn.addEventListener("click", () => {
      settingsModal.classList.remove('hidden');
    });

    closeSettingsBtn.addEventListener("click", () => {
      settingsModal.classList.add('hidden');
    });

    settingsModal.addEventListener("click", (e) => {
      if (e.target === settingsModal) {
        settingsModal.classList.add('hidden');
      }
    });

    themeSelect.addEventListener("change", () => {
      document.documentElement.setAttribute('data-theme', themeSelect.value);
      localStorage.setItem('theme', themeSelect.value);
    });

    languageSelect.addEventListener("change", () => {
      currentLang = languageSelect.value;
      localStorage.setItem('language', currentLang);
      updateTexts();
    });

    const savedTheme = localStorage.getItem('theme') || 'catppuccin';
    const savedLang = localStorage.getItem('language') || 'pt';
    
    themeSelect.value = savedTheme;
    languageSelect.value = savedLang;
    currentLang = savedLang;
    
    document.documentElement.setAttribute('data-theme', savedTheme);
    updateTexts();

    $("choose").addEventListener("click", async () => {
      const dir = await window.electronAPI.chooseFolder();
      if (dir) $("outDir").value = dir;
    });

    $("paste").addEventListener("click", async () => {
      try {
        const text = await navigator.clipboard.readText();
        $("url").value = text.trim();
      } catch (err) {
        console.error('Erro ao colar:', err);
      }
    });

    toggleLogsBtn.addEventListener("click", () => {
      const t = translations[currentLang];
      logsVisible = !logsVisible;
      if (logsVisible) {
        logsSection.classList.remove('hidden');
        toggleLogsBtn.innerHTML = `<span class="icon">ü§ì</span> ${t.hideLogs}`;
      } else {
        logsSection.classList.add('hidden');
        toggleLogsBtn.innerHTML = `<span class="icon">ü§ì</span> ${t.showLogs}`;
      }
    });

    $("download").addEventListener("click", async () => {
      const t = translations[currentLang];
      const url = $("url").value.trim();
      const outDir = $("outDir").value.trim();
      const format = $("format").value.trim();

      if (!url) return alert(t.urlError);
      if (!outDir) return alert(t.folderError);

      progress.value = 0;
      statusEl.textContent = t.downloading;
      logEl.textContent = "";

      try {
        await window.electronAPI.startDownload({ url, outDir, format });
        statusEl.textContent = t.completed;
        progress.value = 100;
      } catch (err) {
        statusEl.textContent = t.failed;
        logEl.textContent += "\nErro: " + err.message;
      }
    });

    window.electronAPI.onProgress((p) => {
      progress.value = p;
    });

    window.electronAPI.onLog((msg) => {
      logEl.textContent += msg;
      logEl.scrollTop = logEl.scrollHeight;
    });
  </script>
</body>
</html>
