<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>SOUMNT! - Seus v√≠deos em um minuto</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="header">
    <img src="logo-soumnt.png" alt="SOUMNT Logo" class="logo" />
    <h1>SOUMNT! - Baixador de v√≠deos</h1>
  </div>

  <div class="row">
    <label for="url">URL:</label>
    <input id="url" type="text" placeholder="https://www.youtube.com/watch?v=..." />
    <button id="paste">
      <span class="icon">üìã</span>
      Colar
    </button>
  </div>

  <div class="row">
    <label for="outDir">Pasta:</label>
    <input id="outDir" type="text" placeholder="Escolha uma pasta de destino" readonly />
    <button id="choose">
      <span class="icon">üìÅ</span>
      Escolher‚Ä¶
    </button>
  </div>

  <div class="row">
    <label for="format">Formato:</label>
    <select id="format">
      <option value="">Melhor qualidade dispon√≠vel</option>
      <option value="best[height<=720]">720p ou menor</option>
      <option value="best[height<=480]">480p ou menor</option>
      <option value="best[height<=360]">360p ou menor</option>
      <option value="bestaudio">Apenas √°udio (melhor qualidade)</option>
      <option value="worst">Menor tamanho de arquivo</option>
      <option value="bestvideo+bestaudio/best">Melhor v√≠deo + √°udio</option>
    </select>
  </div>

  <div class="row download-row">
    <button id="download">
      <span class="icon">‚¨áÔ∏è</span>
      Baixar
    </button>
  </div>

  <div class="status" id="status"></div>

  <progress id="progress" value="0" max="100"></progress>
  <p><small>Obs: apenas baixamos v√≠deos do <code>YouTube</code>, nada de <code>X</code> ou <code>Instagram</code> por enquanto... Quando que ser√° lan√ßada a atualiza√ß√£o? Hahahaha SOUMNT!</small></p>

  <div class="row logs-row">
    <button id="toggleLogs">
      <span class="icon">ü§ì</span>
      Mostrar Logs
    </button>
  </div>

  <div class="logs-section hidden">
    <h3>Log</h3>
    <div id="log"></div>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);
    const statusEl = $("status");
    const logEl = $("log");
    const progress = $("progress");
    const logsSection = document.querySelector('.logs-section');
    const toggleLogsBtn = $("toggleLogs");
    let logsVisible = false;

    $("choose").addEventListener("click", async () => {
      const dir = await window.electronAPI.chooseFolder();
      if (dir) $("outDir").value = dir;
    });

    $("paste").addEventListener("click", async () => {
      try {
        const text = await navigator.clipboard.readText();
        $("url").value = text.trim();
      } catch (err) {
        console.error('Erro ao colar:', err);
      }
    });

    toggleLogsBtn.addEventListener("click", () => {
      logsVisible = !logsVisible;
      if (logsVisible) {
        logsSection.classList.remove('hidden');
        toggleLogsBtn.innerHTML = '<span class="icon">ü§ì</span> Ocultar Logs';
      } else {
        logsSection.classList.add('hidden');
        toggleLogsBtn.innerHTML = '<span class="icon">ü§ì</span> Mostrar Logs';
      }
    });

    $("download").addEventListener("click", async () => {
      const url = $("url").value.trim();
      const outDir = $("outDir").value.trim();
      const format = $("format").value.trim();

      if (!url)  return alert("Informe a URL do v√≠deo.");
      if (!outDir) return alert("Escolha a pasta de destino.");

      progress.value = 0;
      statusEl.textContent = "Baixando‚Ä¶";
      logEl.textContent = "";

      try {
        await window.electronAPI.startDownload({ url, outDir, format });
        statusEl.textContent = "Conclu√≠do ‚úÖ";
        progress.value = 100;
      } catch (err) {
        statusEl.textContent = "Falhou ‚ùå";
        logEl.textContent += "\nErro: " + err.message;
      }
    });

    window.electronAPI.onProgress((p) => {
      progress.value = p;
    });

    window.electronAPI.onLog((msg) => {
      logEl.textContent += msg;
      logEl.scrollTop = logEl.scrollHeight;
    });
  </script>
</body>
</html>
